---
pipeline_stage: 3
pipeline_stage_name: gameplan
pipeline_project: "wcp-mvp"
pipeline_started_at: "2026-02-19T09:48:49-0500"
pipeline_completed_at: "2026-02-19T09:48:56-0500"
pipeline_approved_at: "2026-02-19T10:04:41-0500"
---

# Work Context Protocol (WCP) — Engineering Gameplan

> **Generated by:** Pipeline Stage 3 (Gameplan)
> **Date:** 2026-02-19
> **PRD:** `prd.md`
> **Discovery Report:** N/A (greenfield)
> **Approved Architecture:** `architecture-proposal.md`

---

## 1. Project Overview

### Goals
- Ship a working MCP server with 6 tools that agents can use to track work items
- Validate the adapter pattern: protocol interface cleanly separated from filesystem storage
- Store work context as human-readable markdown files in a git-trackable directory
- Seed 3 namespaces (PIPE, SN, OS) and use WCP for real work immediately

### Scope Summary

| Description | Platform |
|-------------|----------|
| WcpAdapter interface + shared types | MCP Server |
| Filesystem adapter (read/write markdown + YAML config) | MCP Server |
| 6 MCP tool registrations with Zod validation | MCP Server |
| Error handling, input validation | MCP Server |

### Out of Scope
- Adapters for Linear, Jira, GitHub Issues (future phases)
- Git operations (commit, push, pull) — handled externally
- HTTP API — MCP tools only
- Authentication / authorization — local single-user tool
- Full-text search across work item bodies
- Projects as first-class entities
- State machine / transition validation
- Auto-commit on write

### Constraints & Conventions
- Follow entity-index pattern: `McpServer` + `StdioServerTransport` + Zod
- TypeScript strict mode, ES2022, Node16 module resolution
- Dependencies: `@modelcontextprotocol/sdk`, `gray-matter`, `zod`
- Async adapter interface (even though filesystem is sync) per ADR-001

---

## 2. Open Questions & Decisions

> Resolved during Stages 0-2 (PRD + Architecture)

| Question | Status | Decision |
|----------|--------|----------|
| Artifact append vs. replace semantics (PRD Q1) | Resolved | `addArtifacts` field on `UpdateItemInput` — append-only. Covers all agent workflows. |
| How to update body/description (PRD Q6) | Resolved | Optional `body` field on `updateItem`. If provided, replaces body section. If omitted, body untouched. |
| Sync vs. async adapter interface (Arch Q1) | Resolved | Async. Filesystem adapter returns directly (auto-wrapped). Future adapters need `await`. |
| YAML library for config (Arch Q2) | Resolved | `js-yaml` via gray-matter transitive dep. No extra dependency. |
| Default sort for `wcp_list` (Arch Q3) | Resolved | Sort by `updated` descending. |
| Accept `body` on `wcp_create` (Arch Q4) | Resolved | Yes — optional `body` param to avoid a round-trip. |
| File locking for concurrent creates (Arch Q5) | Resolved | No locking for MVP. Single-user tool. |

---

## 3. Functional Milestones

### M0: Discovery & Alignment (Complete)
- [x] PRD written and reviewed
- [x] Architecture proposed, adapter pattern decided (ADR-001), and **approved**
- [x] Open questions resolved
- [x] No discovery report needed (greenfield project)

---

### M1: Project Scaffold & Protocol Types
**What:** Set up the TypeScript project and define the protocol interface — the types and contracts that everything else depends on.
**Size:** S

**Acceptance Criteria:**
- [ ] FMT-003: `validation.ts` exports a function that accepts valid status values (`backlog`, `todo`, `in_progress`, `in_review`, `done`, `cancelled`) and rejects all others
- [ ] FMT-004: `validation.ts` exports a function that accepts valid priority values (`urgent`, `high`, `medium`, `low`) and rejects all others
- [ ] FMT-005: `validation.ts` exports a function that accepts valid type values (`feature`, `bug`, `chore`, `spike`) and rejects all others
- [ ] FMT-002: `adapter.ts` exports TypeScript types matching the frontmatter schema: `WorkItem`, `ItemSummary`, `Namespace`, `Artifact`, `CreateItemInput`, `UpdateItemInput`, `ItemFilters`
- [ ] `adapter.ts` exports the `WcpAdapter` interface with 6 async methods: `listNamespaces`, `listItems`, `getItem`, `createItem`, `updateItem`, `addComment`
- [ ] `errors.ts` exports `WcpError`, `NotFoundError`, `NamespaceNotFoundError`, `ValidationError`
- [ ] `utils.ts` exports `parseCallsign()` that parses `PIPE-12` into `{ namespace: "PIPE", number: 12 }` and throws on invalid format
- [ ] `npm run build` compiles without errors

**MCP Server:**
- [ ] Create `package.json` with dependencies: `@modelcontextprotocol/sdk`, `gray-matter`, `zod`; devDependencies: `@types/node`, `typescript`
- [ ] Create `tsconfig.json` (ES2022, Node16, strict, outDir: dist, rootDir: src)
- [ ] Create `src/adapter.ts` — `WcpAdapter` interface + all shared types
- [ ] Create `src/errors.ts` — error classes
- [ ] Create `src/validation.ts` — status/priority/type validators
- [ ] Create `src/utils.ts` — `parseCallsign()`, `today()`, `now()`

**Dependencies:** None (first milestone)

---

### M2: Markdown Parser & Config Manager
**What:** Build the file I/O layer — parsing markdown files with YAML frontmatter into structured data (and back), and reading/writing the `.wcp/config.yaml` namespace config.
**Size:** S

**Acceptance Criteria:**
- [ ] FMT-001: `parseWorkItem()` correctly parses a markdown file with YAML frontmatter, a body section, and an `## Activity` section into structured `{ frontmatter, body, activity }`
- [ ] FMT-006: `parseWorkItem()` preserves the body section exactly as-is (no reformatting, no whitespace changes)
- [ ] FMT-007: `serializeWorkItem()` preserves the activity log exactly as-is when frontmatter is modified
- [ ] `serializeWorkItem(parseWorkItem(content))` round-trips without data loss for a representative work item file
- [ ] CFG-001: `readConfig()` reads `.wcp/config.yaml` and returns typed `WcpConfig` with namespace definitions
- [ ] CFG-002: `readConfig()` returns each namespace with `key`, `name`, `description`, and `next` counter
- [ ] `writeConfig()` writes valid YAML that `readConfig()` can parse back

**MCP Server:**
- [ ] Create `src/parser.ts` — `parseWorkItem()`, `serializeWorkItem()`
- [ ] Create `src/config.ts` — `readConfig()`, `writeConfig()`

**Dependencies:** M1 (uses types from `adapter.ts`)

---

### M3: Filesystem Adapter
**What:** Implement all 6 `WcpAdapter` methods against the filesystem — scanning directories, reading/writing markdown files, managing the config counter.
**Size:** M

**Acceptance Criteria:**
- [ ] MCP-001: `listNamespaces()` returns all namespaces from config with name, description, and item count (from scanning the directory)
- [ ] MCP-002: `listItems("PIPE", { status: "todo" })` returns only items with `status: todo` in the `PIPE` namespace. All filter combinations work: `status`, `priority`, `type`, `project`, `assignee`, `parent`
- [ ] MCP-003: `listItems()` returns frontmatter fields only — no body, no activity log
- [ ] MCP-004: `getItem("PIPE-12")` returns the full work item: frontmatter, body, and activity log
- [ ] MCP-005: `createItem("PIPE", { title: "Test" })` reads config, increments `PIPE.next`, writes `PIPE/PIPE-{n}.md`, updates config, and returns the new callsign
- [ ] MCP-006: `createItem()` defaults `status` to `backlog`, `created` and `updated` to today's date, and initializes an empty `## Activity` section
- [ ] MCP-007: `updateItem("PIPE-12", { status: "in_progress" })` changes the specified frontmatter fields and sets `updated` to today's date without modifying body or activity
- [ ] MCP-008: `updateItem("PIPE-12", { addArtifacts: [{ type: "prd", title: "PRD", url: "..." }] })` appends the artifact to the existing list without replacing
- [ ] MCP-009: `addComment("PIPE-12", "dave", "Started work.")` appends `**dave** — {ISO datetime}\nStarted work.` to the `## Activity` section and updates `updated` date
- [ ] MCP-010: If a write operation fails mid-way (e.g., invalid frontmatter), the original file is unchanged
- [ ] CFG-004: If `WCP_DATA_PATH` points to a non-existent directory or missing config, the adapter throws a clear error with setup instructions
- [ ] Items are sorted by `updated` descending in `listItems()` results
- [ ] Namespace directory is auto-created if it exists in config but not on disk (on first `createItem`)

**MCP Server:**
- [ ] Create `src/adapters/filesystem.ts` — `FilesystemAdapter implements WcpAdapter`

**Dependencies:** M2 (uses `parser.ts` and `config.ts`)

---

### M4: MCP Server & Tool Registration
**What:** Wire the 6 MCP tools to the adapter via `McpServer` + `StdioServerTransport`. Each tool validates input with Zod, calls the adapter, and returns structured JSON responses (or structured error messages).
**Size:** M

**Acceptance Criteria:**
- [ ] SRV-001: Server starts as a stdio-based MCP server using `@modelcontextprotocol/sdk`
- [ ] SRV-002: Server reads `WCP_DATA_PATH` from environment, defaulting to `~/projects/wcp-data/`
- [ ] SRV-003: Server performs no git operations
- [ ] CFG-003: `WCP_DATA_PATH` env var is respected for the data directory location
- [ ] `wcp_namespaces` tool returns `{ namespaces: [...], count: N }`
- [ ] `wcp_list` tool accepts `namespace` (required) + optional filters, returns `{ items: [...], count: N }`
- [ ] `wcp_get` tool accepts `id`, returns `{ item: { ...fullWorkItem } }`
- [ ] `wcp_create` tool accepts `namespace` + `title` + optional fields, returns `{ id: "PIPE-N" }`
- [ ] `wcp_update` tool accepts `id` + optional field changes, returns `{ updated: true }`
- [ ] `wcp_comment` tool accepts `id` + `author` + `body`, returns `{ commented: true }`
- [ ] Adapter errors (`NotFoundError`, `NamespaceNotFoundError`, `ValidationError`) are caught and returned as structured JSON error messages — not stack traces
- [ ] Zod validation rejects missing required params (e.g., `wcp_create` without `title`) with clear messages

**MCP Server:**
- [ ] Create `src/index.ts` — MCP server setup, 6 tool registrations with Zod schemas, error handling wrapper

**Dependencies:** M3 (uses `FilesystemAdapter`)

---

### M5: QA Test Data & Smoke Test
**What:** Seed the data directory with 3 namespaces and representative work items, then run a full smoke test of all 6 tools via Claude Code.
**Size:** S

**Acceptance Criteria:**
- [ ] CFG-005: Data directory contains `.wcp/config.yaml` with 3 namespaces seeded: `PIPE` (Pipeline Skills), `SN` (Show Notes), `OS` (Operating System)
- [ ] At least 2 work items exist in `PIPE` namespace with varying statuses (e.g., one `todo`, one `done`) for testing filters
- [ ] At least 1 work item exists in `SN` namespace
- [ ] `.mcp.json` in consuming project configures the WCP server with correct `command`, `args`, and `WCP_DATA_PATH`
- [ ] Smoke test passes: `wcp_namespaces` → `wcp_create` → `wcp_get` → `wcp_update` → `wcp_comment` → `wcp_list` (full lifecycle)
- [ ] Seed data is idempotent (running setup again doesn't duplicate items)

**MCP Server:**
- [ ] Create seed script or setup instructions for initializing `wcp-data/` directory
- [ ] Create `.mcp.json` entry for WCP server
- [ ] Run all 6 tools end-to-end and verify output

**Dependencies:** M4 (needs working server)

---

### M6: Edge Cases & Polish
**What:** Handle all error paths, malformed input, and boundary conditions identified in the PRD.
**Size:** S

**Acceptance Criteria:**
- [ ] `wcp_create` with non-existent namespace returns: `"Namespace {ns} not found. Use wcp_namespaces to see available namespaces."`
- [ ] `wcp_get` with non-existent callsign returns: `"Item {id} not found"`
- [ ] `wcp_update` with invalid status returns: `"Invalid status '{val}'. Valid values: backlog, todo, in_progress, in_review, done, cancelled"`
- [ ] `wcp_list` on a namespace with zero items returns empty list `{ items: [], count: 0 }`, not an error
- [ ] `wcp_comment` with empty body returns: `"Comment body cannot be empty"`
- [ ] `wcp_get` on a file with malformed YAML frontmatter returns the raw file content with a parse warning — does not crash
- [ ] `wcp_list` skips files with malformed YAML and includes a warning in the response
- [ ] Callsign validation rejects malformed callsigns (e.g., `pipe-12`, `PIPE`, `12`, `PIPE-abc`)
- [ ] `wcp_update` with `body` param replaces the description section without affecting frontmatter or activity log
- [ ] Work item file deleted outside the MCP server: `wcp_get` returns "not found", `wcp_list` doesn't include it
- [ ] Concurrent `wcp_update` on the same item: last write wins (filesystem semantics). No locking required — accepted for MVP single-user scope.
- [ ] Concurrent `wcp_create` in the same namespace: if a duplicate callsign is generated, file write fails (file already exists) and returns an error. No locking — accepted for MVP.
- [ ] Very large activity log (100+ entries): `wcp_get` returns full file content without pagination. Accepted for MVP — revisit if files exceed ~100KB.

**MCP Server:**
- [ ] Add error handling for malformed YAML in `parser.ts`
- [ ] Add edge case handling in `adapters/filesystem.ts`
- [ ] Add input validation in tool handlers in `index.ts`

**Dependencies:** M5 (test against seed data)

---

## 4. Non-Functional Requirements Checklist

### Data Model & API
> Reviewed and approved in the Architecture Review checkpoint.

- [x] Architecture proposal approved: `architecture-proposal.md`
- [ ] Milestones correctly reference the approved data model (adapter interface, file format, config format)
- [ ] No contradictions between gameplan and approved architecture

### Security & Access Control
- [x] N/A — local tool, single user, no authentication, no multi-tenant scoping
- [ ] Path traversal prevented via callsign format validation (`[A-Z]+-\d+`)
- [ ] YAML injection prevented via gray-matter serialization (auto-quoting)

### Performance
- [x] Data volume: dozens to low hundreds of items per namespace — filesystem scan is acceptable
- [x] No indexes needed — file-per-item with directory-per-namespace is the index
- [x] No caching needed — files are small, reads are fast
- [x] No N+1 risk — each tool makes at most one directory scan + one file read per item

### Observability & Debuggability
- [ ] Server logs startup message to stderr: `[wcp] MCP server running on stdio, data: {path}`
- [ ] Errors include the callsign/namespace in the message for traceability
- [ ] No production access needed — data is local files, debug by reading them directly
- [x] No alerts needed — local tool

### Analytics & Instrumentation
- N/A — local CLI tool, no analytics infrastructure, no event tracking

### Testing Plan

| Type | Coverage | Platform | Owner |
|------|----------|----------|-------|
| Manual smoke test | All 6 tools, full lifecycle | MCP Server | Human (M5) |
| Edge case testing | Error paths, malformed input | MCP Server | Human (M6) |

_Automated test framework (vitest/jest) is a future addition. MVP validates through manual smoke testing via Claude Code._

### Feature Flags & Rollout
- N/A — local tool, no feature flags. Ship and iterate.

### Mobile-Specific
- N/A — no mobile platform.

### Legacy & Migration
- N/A — greenfield project, no existing data or clients.

### Export/Reporting
- N/A — data is human-readable markdown files. No export features.

---

## 5. Dependencies & Risks

| Risk/Dependency | Impact | Mitigation |
|-----------------|--------|------------|
| `gray-matter` doesn't round-trip complex YAML frontmatter perfectly | Med | Test with representative work item files early (M2). If issues found, consider `js-yaml` directly for serialization. |
| Counter race condition on concurrent `wcp_create` | Low | Accepted for MVP (single-user). File creation would fail if duplicate callsign generated — error is surfaced, user retries. |
| `@modelcontextprotocol/sdk` API changes | Low | Pin to `^1.26.0`. Entity-index uses same version successfully. |
| Activity log separator `---\n\n## Activity` appears in body content | Low | Unlikely in practice. If it occurs, the parser splits on the last occurrence. Document as a known limitation. |

---

## 6. Release Plan

### Phases

| Phase | What Ships | Audience |
|-------|-----------|----------|
| Phase 1 (MVP) | All 6 MCP tools, filesystem adapter, 3 seeded namespaces | Dave (single user) |
| Phase 2 (Pipeline Integration) | Pipeline-skills updated to use WCP callsigns | Dave + pipeline agents |
| Phase 3 (Protocol Extraction) | Formal WCP spec, Linear adapter | Open source |

### Done Criteria
- [ ] All 6 tools functional (smoke test passes)
- [ ] All edge cases handled (M6 acceptance criteria met)
- [ ] Server starts cleanly and logs startup message
- [ ] At least one real project tracked in WCP for 1 week before declaring MVP complete

---

## 7. Estimates

| Milestone | Size | Notes |
|-----------|------|-------|
| M0: Discovery & Alignment | Done | Pipeline Stages 0-2 |
| M1: Project Scaffold & Protocol Types | S | 6 files, all type definitions and small utilities |
| M2: Markdown Parser & Config | S | 2 files, focused parsing logic |
| M3: Filesystem Adapter | M | 1 file but all 6 methods with real I/O |
| M4: MCP Server & Tool Registration | M | 1 file, 6 tool registrations with Zod + error handling |
| M5: QA Test Data & Smoke Test | S | Seed data + manual validation |
| M6: Edge Cases & Polish | S | Error handling additions across existing files |

---

## PRD Traceability Matrix

| PRD Requirement | Milestone | Acceptance Criterion |
|----------------|-----------|---------------------|
| MCP-001 | M3 | `listNamespaces()` returns all namespaces with item count |
| MCP-002 | M3 | `listItems()` supports all filter combinations |
| MCP-003 | M3 | `listItems()` returns frontmatter fields only |
| MCP-004 | M3 | `getItem()` returns full content |
| MCP-005 | M3 | `createItem()` increments counter, writes file, returns callsign |
| MCP-006 | M3 | `createItem()` defaults status, created, updated, activity section |
| MCP-007 | M3 | `updateItem()` changes frontmatter, sets updated date |
| MCP-008 | M3 | `updateItem()` with `addArtifacts` appends to list |
| MCP-009 | M3 | `addComment()` appends to activity, updates date |
| MCP-010 | M3 | Atomic writes — failure leaves original file unchanged |
| FMT-001 | M2 | Parser handles frontmatter + body + activity structure |
| FMT-002 | M1, M2 | Types match schema; parser extracts all fields |
| FMT-003 | M1 | Status validation function |
| FMT-004 | M1 | Priority validation function |
| FMT-005 | M1 | Type validation function |
| FMT-006 | M2 | Parser preserves body exactly |
| FMT-007 | M2 | Serializer preserves activity exactly |
| CFG-001 | M2 | Config reads from `.wcp/config.yaml` |
| CFG-002 | M2 | Config returns key, name, description, next |
| CFG-003 | M4 | `WCP_DATA_PATH` env var respected |
| CFG-004 | M3 | Missing data dir / config returns clear error |
| CFG-005 | M5 | Seed 3 namespaces: PIPE, SN, OS |
| SRV-001 | M4 | stdio-based MCP server |
| SRV-002 | M4, M5 | `.mcp.json` configuration |
| SRV-003 | M4 | No git operations |

---

## Approval Checklist

> **This gameplan requires human review and approval before test generation begins.**

### Reviewer: Dave
### Date: 2026-02-19
### Status: Approved

#### Must Verify
- [ ] Milestone breakdown is logical and correctly sequenced
- [ ] Acceptance criteria are specific and testable
- [ ] Every PRD requirement ID is mapped to a milestone (traceability matrix complete)
- [ ] Non-functional requirements checklist is fully addressed
- [ ] Dependencies form a valid DAG (no circular dependencies)
- [ ] Milestone sizes are appropriate (no XL milestones that should be split)
- [ ] Release plan is appropriate

#### Optional Notes
[Any modifications, corrections, or additional context]

---

## Changelog

| Date | Author | Changes |
|------|--------|---------|
| 2026-02-19 | Pipeline | Initial gameplan generated |
